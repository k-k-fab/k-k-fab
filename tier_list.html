<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tierè¡¨</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 2rem;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 1.5rem;
            font-size: 2rem;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6b7280;
        }

        .tier-container {
            margin-bottom: 20px;
        }

        .tier-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 1.2rem;
            color: white;
        }

        .tier-s { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .tier-a { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .tier-b { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .tier-c { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
        .tier-d { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        .tier-f { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }

        .tier-label {
            min-width: 60px;
            text-align: center;
            font-size: 1.5rem;
        }

        .tier-dropzone {
            min-height: 100px;
            padding: 15px;
            border: 3px dashed #e5e7eb;
            border-radius: 10px;
            background: #f9fafb;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .tier-dropzone.drag-over {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .tier-content {
            display: contents;
        }

        .hero-card {
            position: relative;
            width: 120px;
            height: 160px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 10px;
            cursor: grab;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
        }

        .hero-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }

        .hero-card.dragging {
            opacity: 0.8;
            cursor: grabbing;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
        }

        .hero-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            background: #f3f4f6;
        }

        .hero-name {
            font-size: 11px;
            text-align: center;
            color: #333;
            font-weight: 600;
            line-height: 1.2;
            margin-top: 5px;
            word-break: break-word;
        }

        .unassigned-container {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .unassigned-header {
            padding: 15px 20px;
            background: #f3f4f6;
            border-radius: 10px;
            margin-bottom: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            color: #6b7280;
        }

        .empty-message {
            text-align: center;
            color: #9ca3af;
            padding: 20px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            h1 {
                font-size: 1.5rem;
            }

            .hero-card {
                width: 100px;
                height: 140px;
            }

            .hero-image {
                height: 80px;
            }

            .hero-name {
                font-size: 10px;
            }

            .tier-header {
                font-size: 1rem;
                padding: 12px 15px;
            }

            .tier-label {
                min-width: 50px;
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Tierè¡¨</h1>
        
        <div class="controls">
            <button class="btn" onclick="resetTierList()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn btn-secondary" onclick="saveTierList()">ä¿å­˜</button>
            <button class="btn btn-secondary" onclick="loadTierList()">èª­ã¿è¾¼ã¿</button>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-s">
                <span class="tier-label">S</span>
                <span>Tier S - æœ€å¼·</span>
            </div>
            <div class="tier-dropzone" data-tier="S" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-S" class="tier-content"></div>
            </div>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-a">
                <span class="tier-label">A</span>
                <span>Tier A - å¼·ã„</span>
            </div>
            <div class="tier-dropzone" data-tier="A" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-A" class="tier-content"></div>
            </div>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-b">
                <span class="tier-label">B</span>
                <span>Tier B - æ™®é€š</span>
            </div>
            <div class="tier-dropzone" data-tier="B" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-B" class="tier-content"></div>
            </div>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-c">
                <span class="tier-label">C</span>
                <span>Tier C - å¼±ã„</span>
            </div>
            <div class="tier-dropzone" data-tier="C" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-C" class="tier-content"></div>
            </div>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-d">
                <span class="tier-label">D</span>
                <span>Tier D - ã‹ãªã‚Šå¼±ã„</span>
            </div>
            <div class="tier-dropzone" data-tier="D" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-D" class="tier-content"></div>
            </div>
        </div>

        <div class="tier-container">
            <div class="tier-header tier-f">
                <span class="tier-label">F</span>
                <span>Tier F - æœ€å¼±</span>
            </div>
            <div class="tier-dropzone" data-tier="F" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-F" class="tier-content"></div>
            </div>
        </div>

        <div class="unassigned-container">
            <div class="unassigned-header">æœªåˆ†é¡</div>
            <div class="tier-dropzone" data-tier="unassigned" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                <div id="tier-unassigned" class="tier-content"></div>
            </div>
        </div>
    </div>

    <script>
        // ç”»åƒãƒãƒƒãƒ—ï¼ˆresults_multi.html ã¨åŒä¸€ãƒ«ãƒ¼ãƒ«ï¼‰
        const heroImageMap = {
            'Kayo, Armed and Dangerous': 'Kayo_Armed_and_Dangerous.jpg',
            'Kayo, Underhanded Cheat': 'Kayo_Underhanded_Cheat.jpg',
            'Dash I/O': 'Dash I:O.jpg',
            'Katsu, the Wanderer': 'Katsu, the Wanderer.jpg',
            'Uzuri, Switchblade': 'Uzuri, Switchblade.jpg',
            'Victor Goldmane, High and Mighty': 'Victor Goldmane, High and Mighty.jpg',
            'Florian, Rotwood Harbinger': 'Florian, Rotwood Harbringer.jpg',
            'Cindra, Dracai of Retribution': 'Cindra, Dracai of Retribution.jpg',
            'Oscilio, Constella Intelligence': 'Oscilio, Constella Intelligence.jpg',
            'Gravy Bones, Shipwrecked Looter': 'Gravy_Bones_Shipwrecked_Looter.jpg',
            'Verdance, Thorn of the Rose': 'Verdance, Thorn of Rose.jpg',
            //'Kano, Dracai of Aether': 'Kano, Dracai of Aether.jpg',
            'Arakni, Marionette': 'Arakni, Marionette.jpg',
            'Kassai of the Golden Sand': 'Kassai, of the Golden Sand.jpg',
            'Fang, Dracai of Blades': 'Fang, Dracai of Blades.jpg',
            'Pleiades, Superstar': 'Pleiades_Superstar.jpg',
            'Ira, Scarlet Revenger': 'Ira, Scarlet Revenger.jpg',
            'Dorinthea Ironsong': 'Dorinthea Ironsong.jpg',
            'Levia, Shadowborn Abomination': 'Levia, Shadowborn Abomination.jpg',
            'Valda, Seismic Impact': 'Valda_Seismic_Impact_cWNA1HW.jpg',
            'Prism, Awakener of Sol': 'Prism, Awakener of Sol.jpg',
            'Riptide, Lurker of the Deep': 'Riptide, Lurker of the Deep.jpg',
            'Jarl Vetreidi': 'Jarl%20VetreiÄ‘i.jpg',
            'Arakni, Huntsman': 'Arakni, Huntsman.jpg',
            'Arakni, 5L!p3d 7hRu 7h3 cR4X': 'Arakni_Slipped_thru_the_Cracks.jpg',
            'Rhinar, Reckless Rampage': 'Rhinar, Reckless Rampage.jpg',
            'Vynnset, Iron Maiden': 'Vynnset, Iron Maiden.jpg',
            'Marlynn, Treasure Hunter': 'Marlynn_Treasure_Hunter.jpg',
            'Puffin, Hightail': 'Puffin_Hightail.jpg',
            'Betsy, Skin in the Game': 'Betsy, Skin in the Game.jpg',
            'Bravo, Showstopper': 'Bravo, Showstopper.jpg',
            'Fai, Rising Rebellion': 'Fai, Rising Rebellion.jpg',
            'Olympia, Prized Fighter': 'Olympia, Prized Fighter.jpg',
            'Ser Boltyn, Breaker of Dawn': 'Ser Boltyn, Breaker of Dawn.jpg',
            'Tuffnut, Bumbling Hulkster': 'Tuffnut_Bumbling_Hulkster.jpg',
            'Teklovossen, Esteemed Magnate': 'Teklovossen, Esteemed Magnate.jpg',
            'Lyath Goldmane, Vile Savant': 'Lyath_Goldmane_Vile_Savant.jpg',
            "Maxx 'The Hype' Nitro": "Maxx%20'The%20Hype'%20Nitro.jpg",
            //'Bravo, Star of the Show': 'Bravo, Star of the Show.jpg',
            //'Zen, Tamer of Purpose': 'Zen, Tamer of Purpose.jpg',
            //'Nuu, Alluring Desire': 'Nuu, Alluring Desire.jpg',
            //'Chane, Bound by Shadow': 'Chane, Bound by Shadow.jpg',
            //'Viserai, Rune Blood': 'Viserai, Rune Blood.jpg',
            //'Aurora, Shooting Star': 'Aurora_Shooting_Star.jpg',
            //'Dromai, Ash Artist': 'Dromai, Ash Artist.jpg',
            //'Dash, Inventor Extraordinaire': 'Dash, Inventor Extraordinaire.jpg',
            //'Briar, Warden of Thorns': 'Briar, Warden of Thorns.jpg',
            //'Prism, Sculptor of Arc Light': 'Prism, Sculptor of Arc Light.jpg',
            //'Iyslander, Stormbind': 'Iyslander, Stormbind.jpg',
            //'Lexi, Livewire': 'Lexi, Livewire.jpg',
        };

        // heroImageMapã®ã‚­ãƒ¼ã‚’ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ã«ã‚½ãƒ¼ãƒˆã—ã¦è¿”ã™é–¢æ•°
        function getSortedHeroNames() {
            return Object.keys(heroImageMap)
                .filter(key => heroImageMap[key] !== undefined) // æœ‰åŠ¹ãªã‚¨ãƒ³ãƒˆãƒªã®ã¿
                .sort((a, b) => {
                    // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆé †ï¼ˆå¤§æ–‡å­—å°æ–‡å­—ã‚’åŒºåˆ¥ã—ãªã„ï¼‰
                    return a.localeCompare(b, 'en', { sensitivity: 'base' });
                });
        }

        function getHeroImage(heroName) {
            const normalizedName = (heroName || '').trim();
            if (heroImageMap[normalizedName]) {
                return `https://dgmi4fxzalveh.cloudfront.net/media/images/heroes/${heroImageMap[normalizedName]}`;
            }
            for (let [key, filename] of Object.entries(heroImageMap)) {
                if (key.includes(normalizedName) || normalizedName.includes(key)) {
                    return `https://dgmi4fxzalveh.cloudfront.net/media/images/heroes/${filename}`;
                }
                const keyWords = key.split(/[\,\s]+/).filter(w => w.length > 2);
                const nameWords = normalizedName.split(/[\,\s]+/).filter(w => w.length > 2);
                for (let kw of keyWords) {
                    for (let nw of nameWords) {
                        if (kw.toLowerCase() === nw.toLowerCase()) {
                            return `https://dgmi4fxzalveh.cloudfront.net/media/images/heroes/${filename}`;
                        }
                    }
                }
            }
            return 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0iI2Y4ZjlmYSIvPgo8cGF0aCBkPSJNMTYgMTJMMjAgMTZMMTYgMjBMMTIgMTZMMTYgMTJaIiBmaWxsPSIjNjY3ZWVhIi8+Cjwvc3ZnPgo=';
        }

        // Tierãƒ‡ãƒ¼ã‚¿ã®ç®¡ç†
        let tierData = {
            'S': [],
            'A': [],
            'B': [],
            'C': [],
            'D': [],
            'F': [],
            'unassigned': getSortedHeroNames()
        };

        // ã‚¿ãƒƒãƒãƒ‰ãƒ©ãƒƒã‚°ç”¨ã®çŠ¶æ…‹ç®¡ç†
        let touchDragState = {
            isDragging: false,
            draggedCard: null,
            draggedHeroName: null,
            startX: 0,
            startY: 0,
            offsetX: 0,
            offsetY: 0
        };

        // åˆæœŸåŒ–
        function init() {
            loadTierList(true); // åˆæœŸåŒ–æ™‚ã¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ãªã„
            renderAllTiers();
        }

        // å…¨Tierã‚’æç”»
        function renderAllTiers() {
            const tiers = ['S', 'A', 'B', 'C', 'D', 'F', 'unassigned'];
            tiers.forEach(tier => {
                renderTier(tier);
            });
        }

        // ç‰¹å®šã®Tierã‚’æç”»
        function renderTier(tier) {
            const container = document.getElementById(`tier-${tier}`);
            if (!container) return;

            const heroes = tierData[tier] || [];
            
            if (heroes.length === 0) {
                container.innerHTML = '<div class="empty-message">ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„</div>';
                return;
            }

            container.innerHTML = heroes.map(heroName => createHeroCard(heroName, tier)).join('');
            
            // ãƒ‰ãƒ©ãƒƒã‚°ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†è¨­å®š
            container.querySelectorAll('.hero-card').forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                
                // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œ
                card.addEventListener('touchstart', handleTouchStart, { passive: false });
                card.addEventListener('touchmove', handleTouchMove, { passive: false });
                card.addEventListener('touchend', handleTouchEnd, { passive: false });
                card.addEventListener('touchcancel', handleTouchEnd, { passive: false });
            });
        }

        // ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚’ä½œæˆ
        function createHeroCard(heroName, tier) {
            const imageUrl = getHeroImage(heroName);
            return `
                <div class="hero-card" draggable="true" data-hero="${escapeHtml(heroName)}" data-tier="${tier}">
                    <img src="${imageUrl}" alt="${escapeHtml(heroName)}" class="hero-image" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEyMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTAwIiByeD0iNiIgZmlsbD0iI2Y4ZjlmYSIvPgo8cGF0aCBkPSJNNjAgNDBMNzAgNTBMNjAgNjBMNTAgNTBMNjAgNDBaIiBmaWxsPSIjNjY3ZWVhIi8+Cjwvc3ZnPgo='">
                    <div class="hero-name">${escapeHtml(heroName)}</div>
                </div>
            `;
        }

        // ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹
        function handleDragStart(e) {
            // ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸè¦ç´ ãŒå­è¦ç´ ã®å ´åˆã€è¦ªã®.hero-cardã‚’å–å¾—
            const card = e.target.closest('.hero-card');
            if (!card) return;
            
            const heroName = card.dataset.hero;
            if (!heroName) return;
            
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/plain', heroName);
            card.classList.add('dragging');
        }

        // ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†
        function handleDragEnd(e) {
            const card = e.target.closest('.hero-card');
            if (card) {
                card.classList.remove('dragging');
            }
        }

        // ãƒ‰ãƒ©ãƒƒã‚°ã‚ªãƒ¼ãƒãƒ¼
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        // ãƒ‰ãƒ©ãƒƒã‚°ãƒªãƒ¼ãƒ–
        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        // ãƒ‰ãƒ­ãƒƒãƒ—
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            e.currentTarget.classList.remove('drag-over');
            
            const heroName = e.dataTransfer.getData('text/plain');
            const targetTier = e.currentTarget.dataset.tier;
            
            if (!heroName || !targetTier) {
                console.error('ãƒ‰ãƒ­ãƒƒãƒ—å¤±æ•—: heroName=', heroName, 'targetTier=', targetTier);
                return;
            }

            // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã‚’å–å¾—
            const dropX = e.clientX;
            const dropY = e.clientY;
            moveHeroToTier(heroName, targetTier, dropX, dropY);
        }

        // ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚’Tierã«ç§»å‹•ã™ã‚‹å…±é€šé–¢æ•°
        function moveHeroToTier(heroName, targetTier, dropX = null, dropY = null) {
            // å…ƒã®Tierã‹ã‚‰å‰Šé™¤
            Object.keys(tierData).forEach(tier => {
                tierData[tier] = tierData[tier].filter(name => name !== heroName);
            });

            // æ–°ã—ã„Tierã«è¿½åŠ ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰
            if (!tierData[targetTier]) {
                tierData[targetTier] = [];
            }
            
            // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã€æŒ¿å…¥ä½ç½®ã‚’è¨ˆç®—
            // å†æç”»å‰ã«ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã®ä½ç½®ã‚’ç¢ºèª
            if (dropX !== null && dropY !== null) {
                const insertIndex = getInsertIndex(targetTier, dropX, dropY);
                if (insertIndex !== -1 && !tierData[targetTier].includes(heroName)) {
                    tierData[targetTier].splice(insertIndex, 0, heroName);
                } else if (insertIndex === -1 && !tierData[targetTier].includes(heroName)) {
                    tierData[targetTier].push(heroName);
                }
            } else {
                // ä½ç½®ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã„å ´åˆã¯æœ«å°¾ã«è¿½åŠ 
                if (!tierData[targetTier].includes(heroName)) {
                    tierData[targetTier].push(heroName);
                }
            }

            // å†æç”»
            renderAllTiers();
            saveTierList();
        }

        // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã«åŸºã¥ã„ã¦æŒ¿å…¥ä½ç½®ã‚’è¨ˆç®—
        function getInsertIndex(targetTier, dropX, dropY) {
            const container = document.getElementById(`tier-${targetTier}`);
            if (!container) return -1;
            
            const cards = Array.from(container.querySelectorAll('.hero-card'));
            if (cards.length === 0) return 0;
            
            // ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®ã‚«ãƒ¼ãƒ‰ã‚’é™¤å¤–ï¼ˆè‡ªåˆ†è‡ªèº«ã‚’é™¤å¤–ï¼‰
            const filteredCards = cards.filter(card => !card.classList.contains('dragging'));
            
            if (filteredCards.length === 0) return 0;
            
            // å„ã‚«ãƒ¼ãƒ‰ã®ä½ç½®ã‚’ç¢ºèª
            for (let i = 0; i < filteredCards.length; i++) {
                const card = filteredCards[i];
                const rect = card.getBoundingClientRect();
                
                // ã‚«ãƒ¼ãƒ‰ã®ä¸­å¤®Xåº§æ¨™ã‚’è¨ˆç®—
                const cardCenterX = rect.left + rect.width / 2;
                
                // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ãŒã‚«ãƒ¼ãƒ‰ã®å·¦å´ã«ã‚ã‚‹å ´åˆã€ãã®ä½ç½®ã«æŒ¿å…¥
                if (dropX < cardCenterX) {
                    // å…ƒã®é…åˆ—ã§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—
                    const heroName = card.dataset.hero;
                    const indexInTier = tierData[targetTier].indexOf(heroName);
                    return indexInTier !== -1 ? indexInTier : i;
                }
            }
            
            // ã™ã¹ã¦ã®ã‚«ãƒ¼ãƒ‰ã®å³å´ã«ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸå ´åˆã¯æœ«å°¾
            return tierData[targetTier].length;
        }

        // ã‚¿ãƒƒãƒé–‹å§‹
        function handleTouchStart(e) {
            const card = e.target.closest('.hero-card');
            if (!card) return;
            
            const heroName = card.dataset.hero;
            if (!heroName) return;
            
            const touch = e.touches[0];
            const rect = card.getBoundingClientRect();
            
            touchDragState.isDragging = true;
            touchDragState.draggedCard = card;
            touchDragState.draggedHeroName = heroName;
            touchDragState.startX = touch.clientX;
            touchDragState.startY = touch.clientY;
            touchDragState.offsetX = touch.clientX - rect.left;
            touchDragState.offsetY = touch.clientY - rect.top;
            
            card.classList.add('dragging');
            card.style.position = 'fixed';
            card.style.zIndex = '10000';
            card.style.pointerEvents = 'none';
            card.style.transform = 'scale(1.1)';
            card.style.transition = 'none';
            
            // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã
            document.body.style.overflow = 'hidden';
            document.body.style.touchAction = 'none';
            
            updateCardPosition(card, touch.clientX, touch.clientY);
            
            e.preventDefault();
        }

        // ã‚¿ãƒƒãƒç§»å‹•
        function handleTouchMove(e) {
            if (!touchDragState.isDragging) return;
            
            const touch = e.touches[0];
            const card = touchDragState.draggedCard;
            
            if (card) {
                updateCardPosition(card, touch.clientX, touch.clientY);
                
                // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®æ¤œå‡º
                const dropzone = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.tier-dropzone');
                document.querySelectorAll('.tier-dropzone').forEach(zone => {
                    zone.classList.remove('drag-over');
                });
                if (dropzone) {
                    dropzone.classList.add('drag-over');
                }
            }
            
            e.preventDefault();
        }

        // ã‚¿ãƒƒãƒçµ‚äº†
        function handleTouchEnd(e) {
            if (!touchDragState.isDragging) return;
            
            const card = touchDragState.draggedCard;
            const heroName = touchDragState.draggedHeroName;
            
            if (card && heroName) {
                const touch = e.changedTouches[0];
                const dropzone = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.tier-dropzone');
                
                // ã‚«ãƒ¼ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆ
                card.classList.remove('dragging');
                card.style.position = '';
                card.style.zIndex = '';
                card.style.pointerEvents = '';
                card.style.transform = '';
                card.style.left = '';
                card.style.top = '';
                card.style.transition = '';
                
                // ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã®æ¤œå‡º
                document.querySelectorAll('.tier-dropzone').forEach(zone => {
                    zone.classList.remove('drag-over');
                });
                
                if (dropzone) {
                    const targetTier = dropzone.dataset.tier;
                    if (targetTier) {
                        // ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã‚’å–å¾—
                        const dropX = touch.clientX;
                        const dropY = touch.clientY;
                        moveHeroToTier(heroName, targetTier, dropX, dropY);
                    }
                }
            }
            
            // çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            touchDragState.isDragging = false;
            touchDragState.draggedCard = null;
            touchDragState.draggedHeroName = null;
            
            // ãƒšãƒ¼ã‚¸ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’å¾©å…ƒ
            document.body.style.overflow = '';
            document.body.style.touchAction = '';
            
            e.preventDefault();
        }

        // ã‚«ãƒ¼ãƒ‰ã®ä½ç½®ã‚’æ›´æ–°
        function updateCardPosition(card, x, y) {
            card.style.left = (x - touchDragState.offsetX) + 'px';
            card.style.top = (y - touchDragState.offsetY) + 'px';
        }

        // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHtml(str) {
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#39;');
        }

        // Tierãƒªã‚¹ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetTierList() {
            if (!confirm('Tierè¡¨ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            tierData = {
                'S': [],
                'A': [],
                'B': [],
                'C': [],
                'D': [],
                'F': [],
                'unassigned': getSortedHeroNames()
            };
            
            renderAllTiers();
            localStorage.removeItem('tierListData');
        }

        // Tierãƒªã‚¹ãƒˆã‚’ä¿å­˜
        function saveTierList(silent = true) {
            try {
                localStorage.setItem('tierListData', JSON.stringify(tierData));
                if (!silent) {
                    showMessage('ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                }
            } catch (e) {
                showMessage('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }

        // Tierãƒªã‚¹ãƒˆã‚’èª­ã¿è¾¼ã¿
        function loadTierList(silent = false) {
            try {
                const saved = localStorage.getItem('tierListData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // å…¨ãƒ’ãƒ¼ãƒ­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
                    const allHeroes = new Set();
                    Object.values(parsed).forEach(heroes => {
                        heroes.forEach(hero => allHeroes.add(hero));
                    });
                    
                    // æœªåˆ†é¡ã«å­˜åœ¨ã—ãªã„ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚’è¿½åŠ 
                    const allHeroNames = getSortedHeroNames();
                    const missingHeroes = allHeroNames.filter(hero => !allHeroes.has(hero));
                    if (missingHeroes.length > 0) {
                        parsed.unassigned = (parsed.unassigned || []).concat(missingHeroes);
                    }
                    
                    // unassignedã‚’ã‚½ãƒ¼ãƒˆ
                    if (parsed.unassigned) {
                        parsed.unassigned = parsed.unassigned.sort((a, b) => {
                            return a.localeCompare(b, 'en', { sensitivity: 'base' });
                        });
                    }
                    
                    tierData = parsed;
                    renderAllTiers();
                    if (!silent) {
                        showMessage('èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
                    }
                } else {
                    if (!silent) {
                        showMessage('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'info');
                    }
                }
            } catch (e) {
                if (!silent) {
                    showMessage('èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            }
        }

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showMessage(text, type = 'info') {
            // æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
            const existing = document.querySelector('.message');
            if (existing) existing.remove();

            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            message.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(message);
            
            setTimeout(() => {
                message.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => message.remove(), 300);
            }, 2000);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', init);

        // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨CSSï¼ˆå‹•çš„ã«è¿½åŠ ï¼‰
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>

